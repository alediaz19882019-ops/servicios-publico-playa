
{% extends 'base.html' %}

{% block navbar_right %}
<a href="{{ url_for('consulta_reportes') }}" 
   class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 rounded-lg shadow-md transition duration-300">
    Consultar Datos
</a>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto mt-10 bg-white shadow-lg rounded-lg p-6 text-gray-900">
    <h2 class="text-3xl font-bold mb-6 text-center text-teal-700">Agregar Nuevo Reporte</h2>

    <!-- Mensajes Flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="mb-4">
                {% for category, message in messages %}
                    <div class="p-4 rounded-lg text-white 
                                {% if category == 'green' %} bg-green-500 
                                {% elif category == 'red' %} bg-red-500 
                                {% elif category == 'blue' %} bg-blue-500 {% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <form method="POST" enctype="multipart/form-data" class="space-y-8">
        {{ form.hidden_tag() }}

        <!-- Sección: Datos Generales -->
        <div class="border rounded-lg p-4">
            <h3 class="text-xl font-semibold mb-4">Datos Generales</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    {{ form.ID.label(class="block text-gray-700 font-semibold mb-1") }}
                    {{ form.ID(class="w-full border border-gray-300 rounded-lg px-3 py-2") }}
                </div>
                <div>
                    {{ form.colonia.label(class="block text-gray-700 font-semibold mb-1") }}
                    {{ form.colonia(class="w-full border border-gray-300 rounded-lg px-3 py-2") }}
                </div>
                <div class="md:col-span-2">
                    {{ form.REPORTES.label(class="block text-gray-700 font-semibold mb-1") }}
                    {{ form.REPORTES(class="w-full border border-gray-300 rounded-lg px-3 py-2") }}
                </div>
                <div>
                    {{ form.fecha.label(class="block text-gray-700 font-semibold mb-1") }}
                    {{ form.fecha(class="w-full border border-gray-300 rounded-lg px-3 py-2") }}
                </div>
            </div>
        </div>

        <!-- Sección: Parámetros Avanzados -->
        <div class="border rounded-lg p-4">
            <h3 class="text-xl font-semibold mb-4">Parámetros Avanzados</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    {{ form.SYMBOL.label(class="block text-gray-700 font-semibold mb-1") }}
                    {{ form.SYMBOL(class="w-full border border-gray-300 rounded-lg px-3 py-2") }}
                </div>
                <div>
                    {{ form.location.label(class="block text-gray-700 font-semibold mb-1") }}
                    {{ form.location(class="w-full border border-gray-300 rounded-lg px-3 py-2", value=request.args.get('direccion')) }}
                </div>
                <div>
                    {{ form.COLOR.label(class="block text-gray-700 font-semibold mb-1") }}
                    {{ form.COLOR(class="w-full border border-gray-300 rounded-lg px-3 py-2") }}
                </div>
                <div>
                    {{ form.lat.label(class="block text-gray-700 font-semibold mb-1") }}
                    {{ form.lat(class="w-full border border-gray-300 rounded-lg px-3 py-2", value=request.args.get('lat')) }}
                </div>
                <div>
                    {{ form.long.label(class="block text-gray-700 font-semibold mb-1") }}
                    {{ form.long(class="w-full border border-gray-300 rounded-lg px-3 py-2", value=request.args.get('long')) }}
                </div>
            </div>
        </div>

        <!-- Sección: Subir Foto -->
        <div class="border rounded-lg p-4">
            <h3 class="text-xl font-semibold mb-4">Subir Foto</h3>
            <div class="flex flex-col items-center gap-4">
                <img id="previewImg" src="https://via.placeholder.com/150?text=Vista+Previa" class="w-40 h-40 object-cover rounded-lg border">
                {{ form.foto(class="hidden", id="fileInput") }}
                <button type="button" onclick="document.getElementById('fileInput').click()" 
                        class="bg-teal-600 hover:bg-teal-700 text-white font-semibold px-4 py-2 rounded-lg transition duration-300">
                    Seleccionar Foto
                </button>
                <span id="fileName" class="text-gray-600 text-sm">Ningún archivo seleccionado</span>
            </div>
            <p class="text-sm text-gray-500 mt-1">Formatos permitidos: JPG, PNG. Tamaño máximo: 5MB.</p>
        </div>

        <!-- Botones -->
        <div class="flex flex-col sm:flex-row gap-4 mt-6">
            <button type="submit" class="bg-teal-600 hover:bg-teal-700 text-white font-bold px-4 py-3 rounded-lg w-full sm:w-1/2 transition duration-300 shadow-md">
                Guardar
            </button>
            <a href="{{ url_for('tapas_de_registro') }}" class="bg-gray-700 hover:bg-gray-900 text-white font-bold px-4 py-3 rounded-lg w-full sm:w-1/2 text-center transition duration-300 shadow-md">
                Cancelar
            </a>
        </div>
    </form>
</div>

<script>
    document.getElementById('fileInput').addEventListener('change', function() {
        const fileName = this.files.length ? this.files[0].name : 'Ningún archivo seleccionado';
        document.getElementById('fileName').textContent = fileName;

        if (this.files && this.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('previewImg').src = e.target.result;
            }
            reader.readAsDataURL(this.files[0]);
               }
    });
</script>

{% endblock %}
